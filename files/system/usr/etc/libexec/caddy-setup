#!/usr/bin/bash
# Caddy user configuration path setup
# Detects the primary user (UID 1000) and configures Caddy to use their ~/.config/caddy

USER=$(id -nu 1000)
USER_HOME=$(getent passwd "$USER" | cut -d: -f6)

# Write environment file for Caddy service
cat > /etc/default/caddy << EOF
# Auto-generated by caddy-setup.service
# User configuration directory for Caddy
CADDY_USER_CONFIG=${USER_HOME}/.config/caddy
EOF

# Ensure the directory exists with correct permissions
mkdir -p "${USER_HOME}/.config/caddy"
chown -R "${USER}:${USER}" "${USER_HOME}/.config/caddy"

echo "Caddy configured to use: ${USER_HOME}/.config/caddy"
